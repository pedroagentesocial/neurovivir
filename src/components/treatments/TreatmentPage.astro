---
import Card from "../common/Card.astro";
import ButtonSecondary from "../common/ButtonSecondary.astro";
import ProvidersSection from "../providers/ProvidersSection.astro";
import FAQSection from "../sections/FAQSection.astro";
import TestimonialsCarousel from "../sections/TestimonialsCarousel.astro";
import CallInvite from "../sections/CallInvite.astro";
interface Props { treatmentId: string }
const { treatmentId } = Astro.props as Props;
const es = await import(`../../content/treatments/${treatmentId}.es.json`).catch(() => ({ default: null }));
const en = await import(`../../content/treatments/${treatmentId}.en.json`).catch(() => ({ default: null }));
const rawHero = es.default?.heroImage ?? en.default?.heroImage ?? 'https://images.unsplash.com/photo-1520975922284-5cb3f6b38d67?q=80&w=1080&auto=format&fit=crop';
const resolveHero = (img: string) => {
  if (/^https?:\/\//.test(img)) return img;
  const base = import.meta.env.BASE_URL || '/';
  return `${base}${img.replace(/^\//,'')}`;
};
const heroImage = resolveHero(rawHero);
const posts = (await import(`../../content/blog/posts.json`)).default.posts;
const esHelp = (es.default?.helpBullets ?? [
  "Regulación de ansiedad y estrés con herramientas prácticas",
  "Mejora de comunicación y relaciones",
  "Procesamiento de duelo y cambios vitales",
  "Acompañamiento en adaptación migratoria y vida bicultural",
]) as string[];
const enHelp = (en.default?.helpBullets ?? [
  "Anxiety and stress regulation with practical tools",
  "Better communication and relationships",
  "Processing grief and life changes",
  "Support for migration adaptation and bicultural life",
]) as string[];
const esWhy = (es.default?.whyUsBullets ?? [
  "Profesionales licenciados y enfoque basado en evidencia",
  "Sensibilidad cultural y experiencia con población latina y migrante",
  "Atención online segura y flexible",
  "Plan de objetivos y seguimiento claro",
]) as string[];
const enWhy = (en.default?.whyUsBullets ?? [
  "Licensed professionals and evidence-based approach",
  "Cultural sensitivity and experience with Latino/migrant communities",
  "Secure, flexible online care",
  "Goal plan and clear follow-ups",
]) as string[];
---
<section class="w-full bg-neuro-title py-12 md:py-16">
  <div class="mx-auto max-w-6xl px-4">
    <div id="tp-hero-es" class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center mt-8 md:mt-12">
      <div class="space-y-6 text-center md:text-left">
        <h1 class="font-heading text-white text-3xl md:text-5xl">{es.default?.heroTitle}</h1>
        <p class="text-white/90">{es.default?.heroSubtitle}</p>
        <div class="flex gap-3 pt-2 justify-center md:justify-start">
          <a href={`${import.meta.env.BASE_URL}book`} class="rounded-4xl bg-neuro-primaryButton text-white px-6 py-3 hover:scale-105 transition-transform">{es.default?.cta?.book ?? 'Agendar ahora'}</a>
          <a href={`${import.meta.env.BASE_URL}intake`} class="rounded-4xl bg-neuro-secondaryButton text-white px-6 py-3 hover:scale-105 transition-transform">{es.default?.cta?.intake ?? 'Completar intake'}</a>
        </div>
        <p class="text-white/80">{es.default?.trustNote}</p>
      </div>
      <div class="flex justify-center">
        <img src={heroImage} alt="Tratamiento" class="rounded-4xl w-full max-w-md object-cover" />
      </div>
    </div>
    <div id="tp-hero-en" class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center mt-8 md:mt-12 hidden">
      <div class="space-y-6 text-center md:text-left">
        <h1 class="font-heading text-white text-3xl md:text-5xl">{en.default?.heroTitle}</h1>
        <p class="text-white/90">{en.default?.heroSubtitle}</p>
        <div class="flex gap-3 pt-2 justify-center md:justify-start">
          <a href={`${import.meta.env.BASE_URL}book`} class="rounded-4xl bg-neuro-primaryButton text-white px-6 py-3 hover:scale-105 transition-transform">{en.default?.cta?.book ?? 'Book now'}</a>
          <a href={`${import.meta.env.BASE_URL}intake`} class="rounded-4xl bg-neuro-secondaryButton text-white px-6 py-3 hover:scale-105 transition-transform">{en.default?.cta?.intake ?? 'Complete intake'}</a>
        </div>
        <p class="text-white/80">{en.default?.trustNote}</p>
      </div>
      <div class="flex justify-center">
        <img src={heroImage} alt="Treatment" class="rounded-4xl w-full max-w-md object-cover" />
      </div>
    </div>
  </div>
</section>
<div class="mx-auto max-w-6xl px-4 py-10">
  <section class="mt-8">
    <h2 id="tp-benefits-es" class="font-heading text-neuro-title text-3xl md:text-4xl text-center">Beneficios de <span class="text-neuro-secondaryButton">NeuroVivir<sup class="text-sm align-super">®</sup></span></h2>
    <h2 id="tp-benefits-en" class="hidden font-heading text-neuro-title text-3xl md:text-4xl text-center">Benefits of <span class="text-neuro-secondaryButton">NeuroVivir<sup class="text-sm align-super">®</sup></span></h2>
    <div class="mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      <Card class="bg-neuro-detail hover:translate-y-0">
        <div class="flex flex-col items-center text-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M12 7v5l3 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span class="text-neuro-paragraph">Eliminate commute time and scheduling hassles</span>
        </div>
      </Card>
      <Card class="bg-neuro-detail hover:translate-y-0">
        <div class="flex flex-col items-center text-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><path d="M12 21s-7-4.35-7-9a4 4 0 018-1 4 4 0 018 1c0 4.65-7 9-7 9z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/><path d="M3 14h10a3 3 0 013 3v2H6l-3-3z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>
          <span class="text-neuro-paragraph">No search for a therapist or long wait for an appointment</span>
        </div>
      </Card>
      <Card class="bg-neuro-detail hover:translate-y-0">
        <div class="flex flex-col items-center text-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="9" r="3" stroke="currentColor" stroke-width="2"/><path d="M6 18a6 6 0 0112 0" stroke="currentColor" stroke-width="2"/></svg>
          <span class="text-neuro-paragraph">Seamlessly switch providers, at no extra cost</span>
        </div>
      </Card>
      <Card class="bg-neuro-detail hover:translate-y-0">
        <div class="flex flex-col items-center text-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M12 7v2M12 15v2M10 11h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          <span class="text-neuro-paragraph">Receive affordable, high-quality mental health care</span>
        </div>
      </Card>
    </div>
  </section>

  <section id="tp-help-es" class="mt-8">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <div>
        <h2 class="font-heading text-neuro-title text-3xl md:text-4xl">Cómo te ayuda la terapia</h2>
        <ul class="mt-6 space-y-4">
          {esHelp.map((t) => (
            <li class="rounded-4xl border border-neuro-detail bg-white p-5 flex items-start gap-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><path d="M4 12l6 6L20 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span class="text-neuro-paragraph">{t}</span>
            </li>
          ))}
        </ul>
      </div>
      <div>
        <h3 class="font-heading text-neuro-title text-3xl md:text-4xl">Por qué con <span class="text-neuro-primaryButton">NeuroVivir<sup class="text-sm align-super">®</sup></span></h3>
        <ul class="mt-6 space-y-4">
          {esWhy.map((t) => (
            <li class="rounded-4xl border border-neuro-detail bg-white p-5 flex items-start gap-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><path d="M4 12l6 6L20 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span class="text-neuro-paragraph">{t}</span>
            </li>
          ))}
        </ul>
      </div>
    </div>
  </section>
  <section id="tp-help-en" class="hidden mt-8">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <div>
        <h2 class="font-heading text-neuro-title text-3xl md:text-4xl">How therapy helps</h2>
        <ul class="mt-6 space-y-4">
          {enHelp.map((t) => (
            <li class="rounded-4xl border border-neuro-detail bg-white p-5 flex items-start gap-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><path d="M4 12l6 6L20 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span class="text-neuro-paragraph">{t}</span>
            </li>
          ))}
        </ul>
      </div>
      <div>
        <h3 class="font-heading text-neuro-title text-3xl md:text-4xl">Why choose <span class="text-neuro-primaryButton">NeuroVivir<sup class="text-sm align-super">®</sup></span></h3>
        <ul class="mt-6 space-y-4">
          {enWhy.map((t) => (
            <li class="rounded-4xl border border-neuro-detail bg-white p-5 flex items-start gap-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><path d="M4 12l6 6L20 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span class="text-neuro-paragraph">{t}</span>
            </li>
          ))}
        </ul>
      </div>
    </div>
  </section>

  <ProvidersSection posts={posts} />

  <div id="tp-faq-es">
    <FAQSection title="FAQ" items={(es.default?.faq ?? [])} />
  </div>
  <div id="tp-faq-en" class="hidden">
    <FAQSection title="FAQ" items={(en.default?.faq ?? [])} />
  </div>

  <TestimonialsCarousel />
  <CallInvite />

  <script type="module">
    const NV = window.NV_LANG || {};
    const getLang = NV.get || (() => 'es');
    const onLangChange = NV.onChange || (() => {});
    const blocksEs = ['tp-hero-es','tp-help-es','tp-faq-es','tp-benefits-es'];
    const blocksEn = ['tp-hero-en','tp-help-en','tp-faq-en','tp-benefits-en'];
    const setVisible = (ids, visible) => ids.forEach(id => {
      document.getElementById(id)?.classList.toggle('hidden', !visible);
    });
    const update = (lang) => {
      setVisible(blocksEs, lang === 'es');
      setVisible(blocksEn, lang === 'en');
    };
    update(getLang());
    onLangChange(update);
  </script>
</div>
