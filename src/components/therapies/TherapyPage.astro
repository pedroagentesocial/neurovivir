---
import Card from "../common/Card.astro";
import ButtonSecondary from "../common/ButtonSecondary.astro";
import ProvidersSection from "../providers/ProvidersSection.astro";
import FAQSection from "../sections/FAQSection.astro";
import TestimonialsCarousel from "../sections/TestimonialsCarousel.astro";
import CallInvite from "../sections/CallInvite.astro";
interface Props { therapyId: string }
const { therapyId } = Astro.props as Props;
const es = await import(`../../content/therapies/${therapyId}.es.json`).catch(() => ({ default: null }));
const en = await import(`../../content/therapies/${therapyId}.en.json`).catch(() => ({ default: null }));
const heroImage = es.default?.heroImage ?? en.default?.heroImage ?? null;
const resolveHero = (img: string | null) => {
  if (!img) return null;
  if (/^https?:\/\//.test(img)) return img;
  const base = import.meta.env.BASE_URL || '/';
  return `${base}${img.replace(/^\//,'')}`;
};
const heroSrc = resolveHero(heroImage);
const posts = (await import(`../../content/blog/posts.json`)).default.posts;
const esBullets = (es.default?.heroBullets ?? []) as string[];
const enBullets = (en.default?.heroBullets ?? []) as string[];
const esHelp = (es.default?.helpBullets ?? [
  "Regulación de ansiedad y estrés con herramientas prácticas",
  "Mejora de comunicación y relaciones, reparación del vínculo",
  "Procesamiento de duelo, trauma y cambios vitales",
  "Acompañamiento en adaptación migratoria y vida bicultural",
]) as string[];
const enHelp = (en.default?.helpBullets ?? [
  "Anxiety and stress regulation with practical tools",
  "Better communication and relationships, repairing the bond",
  "Processing grief, trauma and life changes",
  "Support for migration adaptation and bicultural life",
]) as string[];
const esWhy = (es.default?.whyUsBullets ?? [
  "Profesionales licenciados, enfoque humano y basado en evidencia",
  "Sensibilidad cultural y experiencia con población latina y migrante",
  "Atención online segura y flexible, pensada para tu realidad",
  "Plan de objetivos y seguimiento claro para ver progreso",
]) as string[];
const enWhy = (en.default?.whyUsBullets ?? [
  "Licensed professionals, human care and evidence-based approach",
  "Cultural sensitivity and experience with Latino and migrant communities",
  "Secure, flexible online care designed for your context",
  "Goal-based plan and clear follow-ups to see progress",
]) as string[];
---
<section class="w-full bg-neuro-title py-12 md:py-16">
  <div class="mx-auto max-w-6xl px-4">
    <div id="tp-hero-es" class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center mt-8 md:mt-12">
      <div class="space-y-6 text-center md:text-left">
        <h1 class="font-heading text-white text-3xl md:text-5xl">{es.default?.heroTitle ?? 'Terapia'}</h1>
        {(es.default?.heroSubtitle) && (<p class="text-white/90 text-lg md:text-xl">{es.default?.heroSubtitle}</p>)}
        {esBullets.length > 0 && (
          <ul class="space-y-3">
            {esBullets.map((b) => (
              <li class="flex items-center gap-3 justify-center md:justify-start">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" class="text-white"><path d="M4 12l6 6L20 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <span class="text-white/90">{b}</span>
              </li>
            ))}
          </ul>
        )}
        <div class="flex gap-3 pt-2 justify-center md:justify-start">
          <a href={`${import.meta.env.BASE_URL}book/`} class="rounded-4xl bg-neuro-primaryButton text-white px-6 py-3 hover:scale-105 transition-transform">{es.default?.cta?.book ?? 'Agendar ahora'}</a>
        </div>
        <p class="text-white/80">{es.default?.trustNote}</p>
      </div>
      <div class="flex justify-center">
        <img src={heroSrc ?? 'https://images.unsplash.com/photo-1520975922284-5cb3f6b38d67?q=80&w=1080&auto=format&fit=crop'} alt="Terapeuta" class="rounded-4xl w-full max-w-md object-cover" />
      </div>
    </div>
    <div id="tp-hero-en" class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center mt-8 md:mt-12 hidden">
      <div class="space-y-6 text-center md:text-left">
        <h1 class="font-heading text-white text-3xl md:text-5xl">{en.default?.heroTitle ?? 'Therapy'}</h1>
        {(en.default?.heroSubtitle) && (<p class="text-white/90 text-lg md:text-xl">{en.default?.heroSubtitle}</p>)}
        {enBullets.length > 0 && (
          <ul class="space-y-3">
            {enBullets.map((b) => (
              <li class="flex items-center gap-3 justify-center md:justify-start">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" class="text-white"><path d="M4 12l6 6L20 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <span class="text-white/90">{b}</span>
              </li>
            ))}
          </ul>
        )}
        <div class="flex gap-3 pt-2 justify-center md:justify-start">
          <a href={`${import.meta.env.BASE_URL}book/`} class="rounded-4xl bg-neuro-primaryButton text-white px-6 py-3 hover:scale-105 transition-transform">{en.default?.cta?.book ?? 'Book now'}</a>
        </div>
        <p class="text-white/80">{en.default?.trustNote}</p>
      </div>
      <div class="flex justify-center">
        <img src={heroSrc ?? 'https://images.unsplash.com/photo-1520975922284-5cb3f6b38d67?q=80&w=1080&auto=format&fit=crop'} alt="Therapist" class="rounded-4xl w-full max-w-md object-cover" />
      </div>
    </div>
  </div>
</section>
  <div class="mx-auto max-w-6xl px-4 py-10">
  <section id="tp-benefits-es" class="mt-8">
    <h2 class="font-heading text-neuro-title text-3xl md:text-4xl text-center">Beneficios de <span class="text-neuro-secondaryButton">NeuroVivir<sup class="text-sm align-super">®</sup></span></h2>
    <div class="mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      <Card class="bg-neuro-detail hover:translate-y-0">
        <div class="flex flex-col items-center text-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M12 7v5l3 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span class="text-neuro-paragraph">Elimina traslados y problemas de agenda</span>
        </div>
      </Card>
      <Card class="bg-neuro-detail hover:translate-y-0">
        <div class="flex flex-col items-center text-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><path d="M12 21s-7-4.35-7-9a4 4 0 018-1 4 4 0 018 1c0 4.65-7 9-7 9z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/><path d="M3 14h10a3 3 0 013 3v2H6l-3-3z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>
          <span class="text-neuro-paragraph">Sin buscar terapeuta ni largas esperas</span>
        </div>
      </Card>
      <Card class="bg-neuro-detail hover:translate-y-0">
        <div class="flex flex-col items-center text-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="9" r="3" stroke="currentColor" stroke-width="2"/><path d="M6 18a6 6 0 0112 0" stroke="currentColor" stroke-width="2"/></svg>
          <span class="text-neuro-paragraph">Cambia de profesional sin costo adicional</span>
        </div>
      </Card>
      <Card class="bg-neuro-detail hover:translate-y-0">
        <div class="flex flex-col items-center text-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M12 7v2M12 15v2M10 11h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          <span class="text-neuro-paragraph">Atención accesible y de alta calidad</span>
        </div>
      </Card>
    </div>
  </section>
  <section id="tp-benefits-en" class="mt-8 hidden">
    <h2 class="font-heading text-neuro-title text-3xl md:text-4xl text-center">Benefits of <span class="text-neuro-secondaryButton">NeuroVivir<sup class="text-sm align-super">®</sup></span></h2>
    <div class="mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      <Card class="bg-neuro-detail hover:translate-y-0">
        <div class="flex flex-col items-center text-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M12 7v5l3 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span class="text-neuro-paragraph">Eliminate commute time and scheduling hassles</span>
        </div>
      </Card>
      <Card class="bg-neuro-detail hover:translate-y-0">
        <div class="flex flex-col items-center text-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><path d="M12 21s-7-4.35-7-9a4 4 0 018-1 4 4 0 018 1c0 4.65-7 9-7 9z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/><path d="M3 14h10a3 3 0 013 3v2H6l-3-3z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>
          <span class="text-neuro-paragraph">No search for a therapist or long wait for an appointment</span>
        </div>
      </Card>
      <Card class="bg-neuro-detail hover:translate-y-0">
        <div class="flex flex-col items-center text-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="9" r="3" stroke="currentColor" stroke-width="2"/><path d="M6 18a6 6 0 0112 0" stroke="currentColor" stroke-width="2"/></svg>
          <span class="text-neuro-paragraph">Seamlessly switch providers, at no extra cost</span>
        </div>
      </Card>
      <Card class="bg-neuro-detail hover:translate-y-0">
        <div class="flex flex-col items-center text-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M12 7v2M12 15v2M10 11h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          <span class="text-neuro-paragraph">Receive affordable, high-quality mental health care</span>
        </div>
      </Card>
    </div>
  </section>
  <section id="tp-help-es" class="mt-8">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <div>
        <h2 class="font-heading text-neuro-title text-3xl md:text-4xl">¿Cómo te ayuda la terapia?</h2>
        <ul class="mt-6 space-y-4">
          {esHelp.map((t) => (
            <li class="rounded-4xl border border-neuro-detail bg-white p-5 flex items-start gap-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><path d="M4 12l6 6L20 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span class="text-neuro-paragraph">{t}</span>
            </li>
          ))}
        </ul>
      </div>
      <div>
        <h3 class="font-heading text-neuro-title text-3xl md:text-4xl">¿Por qué con <span class="text-neuro-primaryButton">NeuroVivir<sup class="text-sm align-super">®</sup></span>?</h3>
        <ul class="mt-6 space-y-4">
          {esWhy.map((t) => (
            <li class="rounded-4xl border border-neuro-detail bg-white p-5 flex items-start gap-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><path d="M4 12l6 6L20 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span class="text-neuro-paragraph">{t}</span>
            </li>
          ))}
        </ul>
      </div>
    </div>
  </section>
  <section id="tp-help-en" class="hidden mt-8">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <div>
        <h2 class="font-heading text-neuro-title text-3xl md:text-4xl">How therapy helps</h2>
        <ul class="mt-6 space-y-4">
          {enHelp.map((t) => (
            <li class="rounded-4xl border border-neuro-detail bg-white p-5 flex items-start gap-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><path d="M4 12l6 6L20 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span class="text-neuro-paragraph">{t}</span>
            </li>
          ))}
        </ul>
      </div>
      <div>
        <h3 class="font-heading text-neuro-title text-3xl md:text-4xl">Why choose <span class="text-neuro-primaryButton">NeuroVivir<sup class="text-sm align-super">®</sup></span></h3>
        <ul class="mt-6 space-y-4">
          {enWhy.map((t) => (
            <li class="rounded-4xl border border-neuro-detail bg-white p-5 flex items-start gap-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" class="text-neuro-title"><path d="M4 12l6 6L20 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span class="text-neuro-paragraph">{t}</span>
            </li>
          ))}
        </ul>
      </div>
    </div>
  </section>

  <section id="tp-steps-es" class="mt-10 rounded-4xl bg-neuro-detail p-6 md:p-8">
    <h2 class="font-heading text-neuro-title text-3xl md:text-4xl text-center">Tu camino de atención, simplificado</h2>
    <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="bg-yellow-100 p-4">
        <img src={`${import.meta.env.BASE_URL}images/check.png`} alt="Paso 1" class="w-full h-40 object-cover" />
        <h3 class="mt-3 font-heading text-neuro-title text-lg">Verifica elegibilidad</h3>
        <p class="text-neuro-paragraph">Confirma cobertura y cuéntanos sobre tus necesidades.</p>
      </div>
      <div class="bg-orange-100 p-4">
        <img src={`${import.meta.env.BASE_URL}images/match.png`} alt="Paso 2" class="w-full h-40 object-cover" />
        <h3 class="mt-3 font-heading text-neuro-title text-lg">Te conectamos</h3>
        <p class="text-neuro-paragraph">Te emparejamos con un terapeuta licenciado acorde a tus objetivos.</p>
      </div>
      <div class="bg-green-100 p-4">
        <img src={`${import.meta.env.BASE_URL}images/start.png`} alt="Paso 3" class="w-full h-40 object-cover" />
        <h3 class="mt-3 font-heading text-neuro-title text-lg">Comienza tus sesiones</h3>
        <p class="text-neuro-paragraph">Inicia terapia por video, voz o chat—en tu horario.</p>
      </div>
    </div>
    <div class="mt-6 flex justify-center">
      <ButtonSecondary href={`${import.meta.env.BASE_URL}faq/`} label="Ver elegibilidad" />
    </div>
  </section>
  <section id="tp-steps-en" class="mt-10 rounded-4xl bg-neuro-detail p-6 md:p-8 hidden">
    <h2 class="font-heading text-neuro-title text-3xl md:text-4xl text-center">Your path to care, simplified</h2>
    <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="bg-yellow-100 p-4">
        <img src={`${import.meta.env.BASE_URL}images/check.png`} alt="Step 1" class="w-full h-40 object-cover" />
        <h3 class="mt-3 font-heading text-neuro-title text-lg">Check eligibility</h3>
        <p class="text-neuro-paragraph">Confirm coverage and share a bit about your needs.</p>
      </div>
      <div class="bg-orange-100 p-4">
        <img src={`${import.meta.env.BASE_URL}images/match.png`} alt="Step 2" class="w-full h-40 object-cover" />
        <h3 class="mt-3 font-heading text-neuro-title text-lg">Get matched</h3>
        <p class="text-neuro-paragraph">We pair you with a licensed therapist suited to your goals.</p>
      </div>
      <div class="bg-green-100 p-4">
        <img src={`${import.meta.env.BASE_URL}images/start.png`} alt="Step 3" class="w-full h-40 object-cover" />
        <h3 class="mt-3 font-heading text-neuro-title text-lg">Start sessions</h3>
        <p class="text-neuro-paragraph">Begin therapy over video, voice or chat—on your schedule.</p>
      </div>
    </div>
    <div class="mt-6 flex justify-center">
      <ButtonSecondary href={`${import.meta.env.BASE_URL}faq/`} label="Check eligibility" />
    </div>
  </section>
  
  <ProvidersSection posts={posts} />

  <div id="tp-faq-es">
    <FAQSection title="FAQ" items={(es.default?.faq ?? [])} />
  </div>
  <div id="tp-faq-en" class="hidden">
    <FAQSection title="FAQ" items={(en.default?.faq ?? [])} />
  </div>

  <TestimonialsCarousel />
  <CallInvite />

  <script type="module">
    const NV = window.NV_LANG || {};
    const getLang = NV.get || (() => 'es');
    const onLangChange = NV.onChange || (() => {});
    const blocksEs = ['tp-hero-es','tp-benefits-es','tp-steps-es','tp-help-es','tp-faq-es'];
    const blocksEn = ['tp-hero-en','tp-benefits-en','tp-steps-en','tp-help-en','tp-faq-en'];
    const setVisible = (ids, visible) => ids.forEach(id => {
      document.getElementById(id)?.classList.toggle('hidden', !visible);
    });
    const update = (lang) => {
      setVisible(blocksEs, lang === 'es');
      setVisible(blocksEn, lang === 'en');
    };
    update(getLang());
    onLangChange(update);
  </script>
</div>
